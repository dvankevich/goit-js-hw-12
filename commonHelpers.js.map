{"version":3,"file":"commonHelpers.js","sources":["../src/js/crypto.js","../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import CryptoJS from 'crypto-js'; // бібліотека вже вважається застарілою\n\nconst secret_key = 'mySecretKey123';\n\n// захист так собі, але краще ніж захардкоджений ключ у відкритому репозиторії.\nexport function getApiKey() {\n  const encApiKey =\n    'U2FsdGVkX1+17bTfSmnFs2tSRlV4rBWWRkysV6VVJBdzQG5Rv4j5mr00F+fRI1DG30R8E2QbnWav3CgE94Qibg==';\n  return CryptoJS.AES.decrypt(encApiKey, secret_key).toString(\n    CryptoJS.enc.Utf8\n  );\n}\n","import { getApiKey } from './crypto';\nimport axios from 'axios';\n\n/**\n * @param {string} searchTerm\n * @param {Number} page number. default: 1.\n * @param {Number} itemsPerPage number. default: 15.\n * @returns JSON object\n */\nexport async function getImagesAxios(searchTerm, page = 1, itemsPerPage = 15) {\n  try {\n    const response = await axios.get('https://pixabay.com/api/', {\n      params: {\n        key: getApiKey(),\n        q: searchTerm,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        per_page: itemsPerPage,\n        page: page,\n      },\n    });\n    //console.log(response);\n\n    return response.data;\n  } catch (error) {\n    console.error('Error fetching photos:', error);\n    throw error;\n  }\n}\n","function getItemMarkdown(item) {\n  // webformatURL — посилання на маленьке зображення для списку карток у галереї\n  // largeImageURL — посилання на велике зображення для модального вікна\n  // tags — рядок з описом зображення. Підійде для атрибута alt\n  // likes — кількість вподобайок\n  // views — кількість переглядів\n  // comments — кількість коментарів\n  // downloads — кількість завантажень\n  return `\n  <li class=\"gallery-item\">\n    <a href=\"${item.largeImageURL}\"\n      class=\"galery-item-image-link\">\n      <img class=\"galery-item-image\"\n        src=\"${item.webformatURL}\"\n        alt=\"${item.tags}\" />\n    </a>\n    <ul class=\"image-info\">\n      <li class=\"image-info-item\">\n        <p class=\"info-item-caption\">Likes</p>\n        <p class=\"info-item-value\">${item.likes}</p>\n      </li>\n      <li class=\"image-info-item\">\n        <p class=\"info-item-caption\">Views</p>\n        <p class=\"info-item-value\">${item.views}</p>\n\n      </li>\n      <li class=\"image-info-item\">\n        <p class=\"info-item-caption\">Comments</p>\n        <p class=\"info-item-value\">${item.comments}</p>\n      </li>\n      <li class=\"image-info-item\">\n        <p class=\"info-item-caption\">Downloads</p>\n        <p class=\"info-item-value\">${item.downloads}</p>\n      </li>\n    </ul>\n  </li>\n`;\n}\n\n/**\n * @param {Array} images array\n * @returns HTML markdown for gallery\n */\nexport function getGalleryMarkdown(images) {\n  return images.map(getItemMarkdown).join('');\n}\n\n/**\n * @param {Object} gallery gallery DOM object\n * @param {String} markdown HTML markdown for gallery\n * @param {String} mode:\n * full (default) - replace with InnerHTML\n * beforebegin, afterbegin, beforeend, afterend - insert with insertAdjacentHTML\n */\nexport function drawGallery(gallery, markdown, mode = 'full') {\n  switch (mode) {\n    case 'full':\n      gallery.innerHTML = markdown;\n      break;\n\n    default:\n      gallery.insertAdjacentHTML(mode, markdown);\n      break;\n  }\n}\n\n/**\n * add class visually-hidden to Object\n * @param {Object} htmlObject DOM Object to show\n */\nexport function showHtmlObject(htmlObject) {\n  htmlObject.classList.remove('visually-hidden');\n}\n\n/**\n * remove class visually-hidden from Object\n * @param {Object} htmlObject DOM Object to hide\n */\nexport function hideHtmlObject(htmlObject) {\n  htmlObject.classList.add('visually-hidden');\n}\n","import { getImagesAxios } from './js/pixabay-api';\nimport {\n  getGalleryMarkdown,\n  drawGallery,\n  showHtmlObject,\n  hideHtmlObject,\n} from './js/render-functions';\nimport SimpleLightbox from 'simplelightbox';\n// Додатковий імпорт стилів\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\n// Додатковий імпорт стилів\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst iziCommon = {\n  message: 'Common message',\n  theme: 'dark',\n  position: 'topRight',\n  titleColor: '#fff',\n  titleSize: '16px',\n  titleLineHeight: '1.5',\n  messageColor: '#fff',\n  messageSize: '16px',\n  messageLineHeight: '1.5',\n  imageWidth: 24,\n};\n\nconst iziError = {\n  ...iziCommon,\n  color: '#ef4040',\n  iconUrl: 'error-icon.svg', // зображення має бути у папці public\n};\n\nconst iziWarning = {\n  ...iziCommon,\n  title: 'Warning',\n  color: '#ffa000',\n  iconUrl: 'caution-icon.svg',\n};\n\nconst myGallery = document.querySelector('.gallery');\nconst searchButton = document.querySelector('.search-button');\nconst searchInput = document.querySelector('.search-input');\nconst simpleLightBox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n  overlayOpacity: 0.8,\n});\nconst loadMoreButton = document.querySelector('.load-more-button');\nconst loadMessage = document.querySelector('.load-message');\nconst secondaryLoadMessage = document.querySelector('.secondary-load-message');\n\nlet page = 1;\nlet searchTermGlobal = '';\nlet perPage = 15; // items per page\nlet totalHits = 0;\n\nsearchButton.addEventListener('click', searchButtonHandler);\n\nfunction searchButtonHandler(event) {\n  event.preventDefault();\n  let searchTerm = String(searchInput.value.trim());\n  searchTerm = searchTerm.replace(/[*]/g, ''); // видалення спецсимволів\n  let galleryMarkdown = '';\n  let images = '';\n\n  if (!searchTerm || searchTerm.length < 2) {\n    iziToast.warning({\n      ...iziWarning,\n      message: 'Enter data for search, please. Min. 2 symbols.',\n    });\n    searchInput.value = ''; // clear input\n    drawGallery(myGallery, ''); // clear gallery\n    hideHtmlObject(loadMoreButton);\n    return;\n  }\n\n  //console.log(`fetch data from backend with search term: ${searchTerm}`);\n  showHtmlObject(loadMessage);\n  drawGallery(myGallery, ''); // clear gallery\n  hideHtmlObject(loadMoreButton);\n\n  searchTermGlobal = searchTerm; // save searchTerm in global variable;\n  page = 1;\n\n  getImagesAxios(searchTerm, page, perPage)\n    .then(images => {\n      //console.log(images);\n      //console.log(images.totalHits);\n      totalHits = images.totalHits;\n      if (images.hits.length === 0) {\n        iziToast.error({\n          ...iziError,\n          message:\n            'Sorry, there are no images matching<br> your search query. Please, try again!',\n        });\n        searchInput.value = ''; // clear input\n        hideHtmlObject(loadMessage);\n        drawGallery(myGallery, ''); // clear gallery\n      } else {\n        searchInput.value = ''; // clear input\n\n        galleryMarkdown = getGalleryMarkdown(images.hits);\n\n        hideHtmlObject(loadMessage);\n        drawGallery(myGallery, galleryMarkdown);\n\n        simpleLightBox.refresh();\n        // drawGallery(myGallery, loadMessageMarkdown, 'afterend'); // for test\n        if (totalHits > page * perPage) {\n          showHtmlObject(loadMoreButton);\n        } else {\n          iziToast.warning({\n            ...iziWarning,\n            message:\n              \"We're sorry, but you've reached<br>the end of search results.\",\n          });\n          console.log('message in line 118');\n\n          hideHtmlObject(loadMoreButton);\n        }\n      }\n    })\n    .catch(error => {\n      console.error('сталося щось дивне', error);\n    });\n}\n\nloadMoreButton.addEventListener('click', loadMoreButtonHandler);\n\nfunction loadMoreButtonHandler(event) {\n  event.preventDefault();\n  page += 1;\n  let galleryMarkdown = '';\n  let images = '';\n\n  const time = Date.now();\n  console.log('--- show load message ---');\n  showHtmlObject(secondaryLoadMessage);\n\n  if (totalHits > page * perPage) {\n    showHtmlObject(loadMoreButton);\n  } else {\n    iziToast.warning({\n      ...iziWarning,\n      message: \"We're sorry, but you've reached<br>the end of search results.\",\n    });\n    console.log('message in line 146');\n\n    hideHtmlObject(loadMoreButton);\n  }\n\n  getImagesAxios(searchTermGlobal, page, perPage) // використовуємо глобальний searchTerm\n    .then(images => {\n      // console.log(images);\n      //console.log(images.totalHits);\n      totalHits = images.totalHits;\n      if (images.hits.length === 0) {\n        // тут вже не перша сторінка і якщо результат пошуку пустий то більше зображень нема\n        iziToast.error({\n          ...iziError,\n          message:\n            \"We're sorry, but you've reached<br>the end of search results.\",\n        });\n        console.log('message in line 163');\n      } else {\n        galleryMarkdown = getGalleryMarkdown(images.hits);\n\n        drawGallery(myGallery, galleryMarkdown, 'beforeend'); // додаємо зображення на екран\n\n        simpleLightBox.refresh();\n\n        // scroll\n        const galleryItem = document.querySelector('.gallery-item');\n        //console.log(galleryItem.getBoundingClientRect().height);\n        //window.scrollBy(0, galleryItem.getBoundingClientRect().height * 2);\n        window.scrollBy({\n          top: galleryItem.getBoundingClientRect().height * 2,\n          left: 0,\n          behavior: 'smooth',\n        });\n\n        //console.log(totalHits > page * perPage, totalHits, page, perPage);\n\n        if (totalHits > page * perPage) {\n          showHtmlObject(loadMoreButton);\n        } else {\n          iziToast.warning({\n            ...iziWarning,\n            message:\n              \"We're sorry, but you've reached<br>the end of search results.\",\n          });\n          console.log('message in line 191');\n\n          hideHtmlObject(loadMoreButton);\n        }\n      }\n    })\n    .catch(error => {\n      console.error('сталося щось дивне', error);\n    });\n  // 2 mentor\n  // load message у мене на комп'ютері відображається 7 - 10 ms\n  // тому його не видно. хіба спеціально робити затримку.\n  console.log(Date.now() - time, '--- hide load message ---');\n  hideHtmlObject(secondaryLoadMessage);\n}\n\n// обробка інших помилок\nwindow.onerror = (message, source, lineno, colno, error) => {\n  // Обробляємо всі необроблені помилки\n  console.error('Unhandled error:', error);\n};\n"],"names":["secret_key","getApiKey","encApiKey","CryptoJS","getImagesAxios","searchTerm","page","itemsPerPage","axios","error","getItemMarkdown","item","getGalleryMarkdown","images","drawGallery","gallery","markdown","mode","showHtmlObject","htmlObject","hideHtmlObject","iziCommon","iziError","iziWarning","myGallery","searchButton","searchInput","simpleLightBox","SimpleLightbox","loadMoreButton","loadMessage","secondaryLoadMessage","searchTermGlobal","perPage","totalHits","searchButtonHandler","event","galleryMarkdown","iziToast","loadMoreButtonHandler","time","galleryItem","message","source","lineno","colno"],"mappings":"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"}